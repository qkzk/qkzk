<html>

<head>
    <title>Pyodide WIP</title>
</head>

<body>
    <div id="python">
        <h3>Script Python</h3>
        <div>
            <textarea id="python_code" name="python_code" rows="5" cols="40">
def f(x):
    return x**2
print("hello world!")
f(3)
</textarea>
        </div>
        <div>
            <button id="run_button">Run</button>
        </div>
        <p id="print_p" style="background-color: yellow;"></p>
        <p id="output" style="background-color: green;"></p>
        <p id="python_error" style="background-color: red;"></p>
        <p id="worker_error" style="background-color: blue;"></p>
    </div>
    <script type="module">

        const python_code = document.getElementById("python_code");
        const run_button = document.getElementById("run_button");
        const output = document.getElementById("output");
        const python_error = document.getElementById("python_error");
        const worker_error = document.getElementById("worker_error");

        function display_response(response) {
            output.innerText = response.output;
            python_error.innerText = response.python_error;
            worker_error.innerText = response.worker_error;
        }

        async function run_python() {

            async function run_code() {
                let context = "";
                let script = python_code.value;
                console.log(script);
                var response = await consumer.run_code(script, context);
                console.log(response);
                display_response(response);
            }


            let consumer = await import("./consumer.js")
            run_button.addEventListener("click", run_code);
        }

        window.onload = run_python;
    </script>
</body>

</html>
