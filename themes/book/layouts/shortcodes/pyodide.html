<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/codemirror.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/theme/xq-light.css">
<link rel="stylesheet" href="{{ .Site.BaseURL }}css/python_editor.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/codemirror.min.js"></script>
<h3>
{{ if .Get `title` }}
    {{ .Get `title` }}
{{ else }}
    Python {{ .Ordinal | safeJS }}
{{ end }}
</h3>
<main>
    <div id="ide_{{ .Ordinal | safeJS }}">
        <textarea id="commands_{{ .Ordinal | safeJS }}" class="commands">
{{ if gt (len .Inner) 1 }}{{ .Inner }}{{ end }}
        </textarea>
        <button class="execute">Exécuter</button>
        <pre id="output_{{ .Ordinal | safeJS }}" class="python_output" style="display: none;">Résultat</pre>
        <pre class="python_error" style="display: none;"></pre>
        <pre class="worker_error" style="display: none;"></pre>
    </div>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/mode/python/python.min.js"></script>
<script type="module">
    import { onElementLoaded, execute } from "{{ .Site.BaseURL }}js/pyodide_consumer.js";

    const url = "{{ .Site.BaseURL }}js/pyodide_webworker.js";

    async function run_python(ide) {
        {{ if .Get `init` }}
        var initfile = "{{ .Site.BaseURL }}"  + "{{ .Page.File.Dir }}" + "{{ .Get `init` }}";
        initfile = initfile.toLowerCase();
        {{ else }}
        var initfile = null;
        {{ end }}
        execute(ide, url, initfile);
    }


    onElementLoaded("div#ide_{{ .Ordinal | safeJS }}").then(() => {
        const ide = document.querySelector("div#ide_{{ .Ordinal | safeJS }}");
        run_python(ide);
    }).catch(() => { });
</script>
