<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/codemirror.css">
<link rel="stylesheet" href="{{ .Site.BaseURL }}css/sql_editor.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/codemirror.js"></script>

<h2>
{{ if .Get `title` }}
    {{ .Get `title` }}
{{ else }}
    SQL
{{ end }}
</h2>
<main>
    <div id="ide_{{ .Ordinal | safeJS }}">
        <label for='commands_{{ .Ordinal | safeJS }}'>Commande SQL</label>
        <br>
        <textarea id="commands_{{ .Ordinal | safeJS }}" class="commands">
{{ if gt (len .Inner) 1 }}{{ .Inner }}{{ end }}
        </textarea>
        <button id="execute" class="execute btn-sql">Exécuter</button>
        <div id="error" class="error"></div>
        <pre id="output_{{ .Ordinal | safeJS }}" class="output">Résultat</pre>
    </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/mode/sql/sql.min.js"></script>
<script type="text/javascript" src="{{ .Site.BaseURL }}js/sql_ide.js"></script>
<script>
    {{ if .Get `dbfile` }}
        var dbfile = "{{ .Site.BaseURL }}" + "/" + "{{ .Page.File.Dir }}" + "{{ .Get `dbfile` }}";
        console.log("dbfile", dbfile);
    {{ else }}
        var dbfile = null;
    {{ end }}

    {{ if .Get `init` }}
        var init_file = "{{ .Site.BaseURL }}" + "/" + "{{ .Page.File.Dir }}" + "{{ .Get `init` }}";
    {{ else }}
        var init_file = null;
    {{ end }}

    var worker_url = "{{ .Site.BaseURL }}js/worker.sql-wasm.js";

    onElementLoaded("div#ide_{{ .Ordinal | safeJS }}").then(() => {
        const ide = document.querySelector("div#ide_{{ .Ordinal | safeJS }}");
        load(ide, worker_url, dbfile, init_file);
    }).catch(() => { });
</script>
